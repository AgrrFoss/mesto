(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._link=e.link,this._name=e.name,this._id=e._id,this.likes=e.likes,this._userId="b9b7acc38d7000eebabc5bed",this._ownerId=e.owner._id,this._cardTemplate=n,this._handleViewImage=r,this._handleLikeImage=o,this._handleDeleteCard=i}var n,r;return n=t,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardTemplate).content.querySelector(".element").cloneNode(!0)}},{key:"getCard",value:function(){this._element=this._getTemplate(),this._setEventListeners();var e=this._element.querySelector(".element__image"),t=this._element.querySelector(".element__title");return e.src=this._link,t.textContent=this._name,e.alt=this._name,this.addLikeCounter(this.likes),this._ownerId!==this._userId&&this._element.removeChild(this._element.querySelector(".element__delete")),!0===this.isLiked()&&this._element.querySelector(".element__like").classList.add("element__like_active"),this._element}},{key:"addLikeCounter",value:function(e){this._element.querySelector(".element__like-counter").textContent=e.length}},{key:"_setEventListeners",value:function(){var e=this;this._element.querySelector(".element__delete").addEventListener("click",(function(){e._handleDeleteCard(e)})),this._element.querySelector(".element__like").addEventListener("click",(function(){e._handleLikeImage(e)})),this._element.querySelector(".element__image").addEventListener("click",(function(){e._handleViewImage(e._link,e._name)}))}},{key:"isLiked",value:function(){var e=this;return Boolean(Array.from(this.likes).find((function(t){return t._id===e._userId})))}},{key:"changeLike",value:function(){this._element.querySelector(".element__like").classList.toggle("element__like_active")}},{key:"deleteCardFromDOM",value:function(){this._element.remove(),this._element=null}}])&&e(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=document.querySelector(t)}var t,r;return t=e,(r=[{key:"rendererItems",value:function(e){var t=e.items,n=e.renderer;t.forEach((function(e){n(e)}))}},{key:"addItem",value:function(e){this._container.append(e)}},{key:"addNewCard",value:function(e){this._container.prepend(e)}}])&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"openPopup",value:function(){document.addEventListener("keyup",this._handleEscClose),this._popup.classList.add("popup_opened")}},{key:"closePopup",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keyup",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.closePopup()}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("click",(function(t){console.log(t),(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__close"))&&e.closePopup()}))}}])&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=l(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},a.apply(this,arguments)}function l(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function f(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(r);if(o){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return f(this,e)});function u(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,e))._form=n._popup.querySelector(".popup__form"),n._submitButton=n._form.querySelector(".popup__submit"),n._submitHandler=t,n._inputList=Array.from(n._form.querySelectorAll(".popup__input")),n}return t=u,(n=[{key:"_getInputValues",value:function(){return this._inputList.reduce((function(e,t){return e[t.name]=t.value,e}),{})}},{key:"veiwLoad",value:function(e){this._submitButton.textContent=e}},{key:"setEventListeners",value:function(){var e=this;a(p(u.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e._submitHandler(e._getInputValues())}))}},{key:"closePopup",value:function(){a(p(u.prototype),"closePopup",this).call(this),this._form.reset()}}])&&c(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(i),d=document.querySelector("#photoPopup"),h=(d.querySelector(".popup__image"),d.querySelector(".popup__image-name"),document.querySelector("#popupEdit").querySelector(".popup__form")),_=document.querySelector("#popupAdd").querySelector(".popup__form"),v=document.querySelector(".profile"),b=v.querySelector(".profile__edit"),m=v.querySelector(".profile__add-button"),g=v.querySelector(".profile__ava"),w=v.querySelector(".profile__ava-edit"),k=document.querySelector("#popupAva .popup__form"),E={input:".popup__input",submit:".popup__submit",buttonUnactive:"popup__submit_unactive",inputClassError:"popup__input_type_error",errorClass:"popup__input-error"};function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=function(){function e(t){var n=t.userNameSelector,r=t.UserJobSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userName=v.querySelector(n),this._userJob=v.querySelector(r),this._avatar=v.querySelector(".profile__ava")}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{userName:this._userName.textContent,userJob:this._userJob.textContent}}},{key:"setUserInfo",value:function(e){var t=e.userName,n=e.userJob,r=e.userAva;this._userName.textContent=t,this._userJob.textContent=n,this._avatar.src=r}}])&&O(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var L=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),j(this,"_showInputError",(function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r._config.inputClassError),o.textContent=n,o.classList.add(r._config.errorClass)})),j(this,"_hideInputError",(function(e,t){var n=r._formElement.querySelector(".".concat(t.id,"-error"));t.classList.remove(r._config.inputClassError),n.classList.remove(r._config.errorClass),n.textContent=""})),j(this,"_isValid",(function(e,t){t.validity.valid?r._hideInputError(e,t):r._showInputError(e,t,t.validationMessage)})),j(this,"_hasInvalidInput",(function(e){return e.some((function(e){return!e.validity.valid}))})),j(this,"_toggleButtonState",(function(e,t){r._hasInvalidInput(e)?r.disableSubmitButton(t):(t.removeAttribute("disabled",!0),t.classList.remove(r._config.buttonUnactive))})),this._formElement=t,this._config=n}var t,n;return t=e,(n=[{key:"disableSubmitButton",value:function(e){e.classList.add(this._config.buttonUnactive),e.setAttribute("disabled",!0)}},{key:"_setEventListeners",value:function(e){var t=this,n=Array.from(e.querySelectorAll(this._config.input)),r=this._formElement.querySelector(this._config.submit);this._toggleButtonState(n,r),n.forEach((function(o){o.addEventListener("input",(function(){t._isValid(e,o),t._toggleButtonState(n,r)}))}))}},{key:"enableValidation",value:function(){this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners(this._formElement)}}])&&P(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=T(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},I.apply(this,arguments)}function T(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},R(e,t)}function x(e,t){if(t&&("object"===C(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}var N=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=D(r);if(o){var n=D(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return x(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._image=t._popup.querySelector(".popup__image"),t._title=t._popup.querySelector(".popup__image-name"),t}return t=u,(n=[{key:"openPopup",value:function(e,t){this._image.src=e,this._image.alt=t,this._title.textContent=t,I(D(u.prototype),"openPopup",this).call(this)}}])&&q(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(i);function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var A=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=t,this._token=n,this._headers={authorization:this._token,"Content-Type":"application/json"}}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(e){return fetch("".concat(this._url).concat(e),{method:"GET",headers:this._headers}).then((function(e){if(e.ok)return e.json()}))}},{key:"postUserInfo",value:function(e,t){return fetch("".concat(this._url).concat(e),{method:"PATCH",headers:this._headers,body:JSON.stringify(t)}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}},{key:"getCard",value:function(e){return fetch("".concat(this._url).concat(e),{method:"GET",headers:this._headers}).then((function(e){if(e.ok)return e.json()}))}},{key:"postCard",value:function(e,t){return fetch("".concat(this._url).concat(e),{method:"POST",headers:this._headers,body:JSON.stringify(t)}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}},{key:"likeCard",value:function(e,t){return fetch("".concat(this._url,"/cards/").concat(e,"/likes"),{method:t?"DELETE":"PUT",headers:this._headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}},{key:"deleteCard",value:function(e){return fetch("".concat(this._url,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}}])&&U(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function V(){return V="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=H(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},V.apply(this,arguments)}function H(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=G(e)););return e}function M(e,t){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},M(e,t)}function F(e,t){if(t&&("object"===B(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},G(e)}var z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&M(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=G(r);if(o){var n=G(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return F(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._form=t._popup.querySelector(".popup__form"),t}return t=u,(n=[{key:"setEventListeners",value:function(e){var t=this;V(G(u.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(n){n.preventDefault(),e(),t.closePopup()}))}}])&&J(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(i),K=new L(_,E);K.enableValidation(),new L(h,E).enableValidation(),new L(k,E).enableValidation();var Q=new A("https://mesto.nomoreparties.co/v1/cohort-43","5df93b18-5437-4244-a6a2-8b097c8cb05f"),W=new S({userNameSelector:".profile__title",UserJobSelector:".profile__desc"});Q.getUserInfo("/users/me").then((function(e){W.setUserInfo({userName:e.name,userJob:e.about,userAva:e.avatar})}));var X=new y("#popupEdit",(function(e){X.veiwLoad("Сохранение");var t={name:e.name,about:e.job};Q.postUserInfo("/users/me",t).then((function(e){W.setUserInfo({userName:e.name,userJob:e.about,userAva:e.avatar})})).finally((function(){X.veiwLoad("Сохранить")})),X.closePopup()}));X.setEventListeners();var Y=new y("#popupAva",(function(e){Y.veiwLoad("Сохранение");var t={avatar:e.avaLink};Q.postUserInfo("/users/me/avatar",t).then((function(e){g.src=e.avatar,Y.closePopup()})).finally((function(){Y.veiwLoad("Сохранить")}))}));Y.setEventListeners();var Z=new N("#photoPopup");function $(e){Q.likeCard(e._id,e.isLiked()).then((function(t){console.log(t.likes),e.addLikeCounter(t.likes),e.likes=t.likes,e.changeLike()})).catch((function(e){return console.log(e)}))}Z.setEventListeners();var ee=new z("#popupDelete");function te(e){var n=new t(e,"#elementTemplate",(function(e,t){return Z.openPopup(e,t)}),$,(function(){ee.openPopup(),ee.setEventListeners((function(){Q.deleteCard(e._id).then(n.deleteCardFromDOM())}))}));return n.getCard()}console.log(ee);var ne=new r(".elements");Q.getCard("/cards").then((function(e){ne.rendererItems({items:e,renderer:function(e){ne.addItem(te(e))}})}));var re=new y("#popupAdd",(function(e){re.veiwLoad("Сохранение");var t={name:e.placeName,link:e.link};Q.postCard("/cards",t).then((function(e){var t=te(e);ne.addNewCard(t)})).finally((function(){re.veiwLoad("Создать")})),re.closePopup()}));re.setEventListeners(),w.addEventListener("click",(function(){return Y.openPopup()})),b.addEventListener("click",(function(){return e=W.getUserInfo(),document.querySelector("#popupEdit #nameInput").value=e.userName,document.querySelector("#popupEdit #jobInput").value=e.userJob,void X.openPopup();var e})),m.addEventListener("click",(function(){return K.enableValidation(),void re.openPopup()}))})();